<main class="min-h-screen bg-[#0d1117] text-white pb-20">
  <div class="container mx-auto px-4 py-8">

    <!-- Header -->
    <div class="mb-8">
      <h1 class="text-3xl font-bold">My Orders</h1>
      <p class="text-gray-400 text-sm mt-1">{{ getTotalOrders() }} orders found</p>
    </div>

    <!-- Loading -->
    <div *ngIf="isLoading()" class="flex flex-col items-center justify-center py-20 gap-4">
      <div class="w-12 h-12 border-4 border-cyan-500/30 border-t-cyan-500 rounded-full animate-spin"></div>
      <p class="text-gray-400">Loading your orders...</p>
    </div>

    <!-- Error -->
    <div *ngIf="!isLoading() && errorMessage()" class="flex flex-col items-center justify-center py-20 gap-4">
      <div class="text-5xl">‚ö†Ô∏è</div>
      <p class="text-red-400 font-medium">{{ errorMessage() }}</p>
      <button (click)="loadOrders()" class="px-6 py-2.5 bg-cyan-600 hover:bg-cyan-700 rounded-lg font-medium transition-all">
        Try Again
      </button>
    </div>

    <!-- Content -->
    <div *ngIf="!isLoading() && !errorMessage()">

      <!-- Empty State -->
      <div *ngIf="orders().length === 0" class="flex flex-col items-center justify-center py-20">
        <div class="text-6xl mb-4">üì¶</div>
        <h2 class="text-2xl font-bold mb-2">No orders yet</h2>
        <p class="text-gray-400 mb-6">Start shopping to place your first order!</p>
        <button (click)="goToShop()" class="px-6 py-3 bg-cyan-600 hover:bg-cyan-700 rounded-lg font-semibold transition-all">
          Browse Products
        </button>
      </div>

      <div *ngIf="orders().length > 0">
        <!-- Stats Row -->
        <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-8">
          <div class="bg-[#161b22] border border-white/10 rounded-2xl p-4 text-center">
            <p class="text-3xl font-black text-cyan-400">{{ getTotalOrders() }}</p>
            <p class="text-xs text-gray-500 mt-1 uppercase tracking-wider">Total Orders</p>
          </div>
          <div class="bg-[#161b22] border border-white/10 rounded-2xl p-4 text-center">
            <p class="text-3xl font-black text-purple-400">${{ getTotalSpent().toFixed(2) }}</p>
            <p class="text-xs text-gray-500 mt-1 uppercase tracking-wider">Total Spent</p>
          </div>
          <div class="bg-[#161b22] border border-white/10 rounded-2xl p-4 text-center">
            <p class="text-3xl font-black text-blue-400">{{ getPaidCount() }}</p>
            <p class="text-xs text-gray-500 mt-1 uppercase tracking-wider">Paid</p>
          </div>
          <div class="bg-[#161b22] border border-white/10 rounded-2xl p-4 text-center">
            <p class="text-3xl font-black text-green-400">{{ getDeliveredCount() }}</p>
            <p class="text-xs text-gray-500 mt-1 uppercase tracking-wider">Delivered</p>
          </div>
        </div>

        <!-- Filters -->
        <div class="flex flex-wrap gap-2 mb-6">
          <button *ngFor="let f of filters"

            (click)="changeFilter(f)"
            class="px-4 py-2 rounded-xl text-sm font-medium transition-all border"
            [class.bg-cyan-600]="selectedFilter === f"
            [class.border-cyan-600]="selectedFilter === f"
            [class.text-white]="selectedFilter === f"
            [class.bg-transparent]="selectedFilter !== f"
            [class.border-white/10]="selectedFilter !== f"
            [class.text-gray-400]="selectedFilter !== f"
            [class.hover:border-white/30]="selectedFilter !== f"
          >
            {{ f | titlecase }}
          </button>
        </div>

        <!-- Orders Grid -->
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-5">
          <div
            *ngFor="let order of filteredOrders(); trackBy: trackById"
            class="bg-[#161b22] border border-white/10 hover:border-cyan-500/30 rounded-2xl overflow-hidden transition-all"
          >
            <!-- Card Header -->
            <div class="p-5 border-b border-white/5">
              <div class="flex items-start justify-between gap-3">
                <!-- Order ID + Date -->
                <div>
                  <p class="text-xs text-gray-500 mb-1">Order ID</p>
                  <p class="font-bold text-lg">#{{ order._id.slice(-6).toUpperCase() }}</p>
                  <p class="text-xs text-gray-500 mt-1 flex items-center gap-1">
                    <mat-icon class="!text-sm">calendar_today</mat-icon>
                    {{ formatDate(order.createdAt) }}
                  </p>
                </div>

                <!-- Status + Payment -->
                <div class="flex flex-col items-end gap-2">
                  <span
                    class="px-3 py-1 rounded-full text-xs font-bold"
                    [class]="getStatus(order).color"
                  >
                    {{ getStatus(order).label }}
                  </span>
                  <span class="text-xs text-gray-500 flex items-center gap-1">
                    {{ getPaymentIcon(order.paymentMethodType) }}
                    {{ order.paymentMethodType | titlecase }}
                  </span>
                </div>
              </div>
            </div>

            <!-- Pricing -->
            <div class="px-5 py-4 border-b border-white/5">
              <div class="flex items-center justify-between mb-1.5">
                <span class="text-gray-400 text-sm">Total Amount</span>
                <span class="text-2xl font-black text-cyan-400">${{ order.totalOrderPrice.toFixed(2) }}</span>
              </div>
              <div class="flex items-center justify-between text-sm">
                <span class="text-gray-600">Tax</span>
                <span class="text-gray-400">${{ order.taxPrice.toFixed(2) }}</span>
              </div>
              <div class="flex items-center justify-between text-sm">
                <span class="text-gray-600">Shipping</span>
                <span class="text-gray-400">
                  {{ order.shippingPrice === 0 ? 'Free' : '$' + order.shippingPrice.toFixed(2) }}
                </span>
              </div>
            </div>

            <!-- Shipping Address -->
            <div class="px-5 py-4 border-b border-white/5">
              <p class="text-xs text-gray-500 uppercase tracking-wider mb-2 flex items-center gap-1">
                <mat-icon class="!text-sm text-orange-500">location_on</mat-icon>
                Shipping Address
              </p>
              <p class="text-sm text-gray-300">{{ order.shippingAddress.details }}</p>
              <div class="flex items-center gap-4 mt-1.5 text-xs text-gray-500">
                <span class="flex items-center gap-1">
                  <mat-icon class="!text-sm">location_city</mat-icon>
                  {{ order.shippingAddress.city }}
                </span>
                <span class="flex items-center gap-1">
                  <mat-icon class="!text-sm">phone</mat-icon>
                  {{ order.shippingAddress.phone }}
                </span>
              </div>
            </div>

            <!-- Items Toggle -->
            <button
              (click)="toggleExpand(order._id)"
              class="w-full px-5 py-3.5 flex items-center justify-between hover:bg-white/5 transition-all"
            >
              <span class="text-sm font-medium flex items-center gap-2">
                <mat-icon class="!text-base text-orange-400">inventory_2</mat-icon>
                {{ getTotalItems(order) }} Item{{ getTotalItems(order) > 1 ? 's' : '' }}
              </span>
              <mat-icon class="!text-base text-gray-500 transition-transform" [class.rotate-180]="isExpanded(order._id)">
                expand_more
              </mat-icon>
            </button>

            <!-- Expanded Items -->
            <div *ngIf="isExpanded(order._id)" class="px-5 pb-5 space-y-3 border-t border-white/5 pt-4">
              <div
                *ngFor="let item of order.cartItems"
                class="flex items-center gap-3 bg-[#0d1117] rounded-xl p-3"
              >
                <!-- Product Image -->
                <img
                  [src]="item.product.imageCover"
                  [alt]="item.product.title"
                  class="w-14 h-14 rounded-lg object-cover shrink-0"
                  (error)="$any($event.target).src='https://via.placeholder.com/56'"
                />

                <!-- Product Info -->
                <div class="flex-1 min-w-0">
                  <p class="font-medium text-sm truncate">{{ item.product.title }}</p>
                  <p class="text-xs text-gray-500 mt-0.5">
                    {{ item.product.category.name }}
                    <span *ngIf="item.color"> ¬∑ {{ item.color }}</span>
                  </p>
                  <p class="text-xs text-gray-500">Qty: {{ item.count }}</p>
                </div>

                <!-- Price -->
                <p class="font-bold text-sm text-cyan-400 shrink-0">
                  ${{ (item.price * item.count).toFixed(2) }}
                </p>
              </div>

              <!-- Pricing Breakdown -->
              <div class="border-t border-white/5 pt-3 space-y-1.5 text-sm">
                <div class="flex justify-between text-gray-500">
                  <span>Tax</span>
                  <span>${{ order.taxPrice.toFixed(2) }}</span>
                </div>
                <div class="flex justify-between text-gray-500">
                  <span>Shipping</span>
                  <span>{{ order.shippingPrice === 0 ? 'Free' : '$' + order.shippingPrice.toFixed(2) }}</span>
                </div>
                <div class="flex justify-between text-white font-bold pt-1 border-t border-white/5">
                  <span>Total</span>
                  <span class="text-cyan-400">${{ order.totalOrderPrice.toFixed(2) }}</span>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- No filtered results -->
        <div *ngIf="filteredOrders().length === 0" class="text-center py-12">
          <p class="text-gray-500">No orders match this filter</p>
        </div>
      </div>
    </div>
  </div>
</main>