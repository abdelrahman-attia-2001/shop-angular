<div class="min-h-screen bg-[#0d1117] text-white">

  <!-- Header -->
  <div class="bg-gradient-to-r from-[#0d1b2a] to-[#1a2d42] border-b border-white/10 px-6 py-8">
    <div class="max-w-5xl mx-auto">
      <!-- Back -->
      <button (click)="goBack()" class="flex items-center gap-2 text-gray-400 hover:text-white text-sm mb-6 transition-colors">
        <mat-icon class="!text-base">arrow_back</mat-icon>
        Back to Home
      </button>

      <!-- Profile Info -->
      <div class="flex items-center gap-5">
        <div class="w-20 h-20 bg-[#1e3a5f] rounded-2xl flex items-center justify-center text-2xl font-bold text-cyan-400 border border-cyan-500/20">
          {{ getInitials() }}
        </div>
        <div>
          <h1 class="text-3xl font-bold">My Profile</h1>
          <p class="text-gray-400 mt-1">Manage your account settings and preferences</p>
        </div>
      </div>
    </div>
  </div>

  <!-- Tabs -->
  <div class="border-b border-white/10 bg-[#0d1117]">
    <div class="max-w-5xl mx-auto px-6">
      <div class="flex gap-1">
        <button
          (click)="setTab('profile')"
          class="flex items-center gap-2 px-5 py-4 text-sm font-medium transition-all relative"
          [class.text-white]="activeTab === 'profile'"
          [class.text-gray-500]="activeTab !== 'profile'"
          [class.hover:text-gray-300]="activeTab !== 'profile'"
        >
          <mat-icon class="!text-lg">person</mat-icon>
          Profile
          <span *ngIf="activeTab === 'profile'" class="absolute bottom-0 left-0 right-0 h-0.5 bg-cyan-500 rounded-t-full"></span>
        </button>

        <button
          (click)="setTab('addresses')"
          class="flex items-center gap-2 px-5 py-4 text-sm font-medium transition-all relative"
          [class.text-white]="activeTab === 'addresses'"
          [class.text-gray-500]="activeTab !== 'addresses'"
          [class.hover:text-gray-300]="activeTab !== 'addresses'"
        >
          <mat-icon class="!text-lg">location_on</mat-icon>
          Addresses
          <span *ngIf="activeTab === 'addresses'" class="absolute bottom-0 left-0 right-0 h-0.5 bg-cyan-500 rounded-t-full"></span>
        </button>

        <button
          (click)="setTab('security')"
          class="flex items-center gap-2 px-5 py-4 text-sm font-medium transition-all relative"
          [class.text-white]="activeTab === 'security'"
          [class.text-gray-500]="activeTab !== 'security'"
          [class.hover:text-gray-300]="activeTab !== 'security'"
        >
          <mat-icon class="!text-lg">shield</mat-icon>
          Security
          <span *ngIf="activeTab === 'security'" class="absolute bottom-0 left-0 right-0 h-0.5 bg-cyan-500 rounded-t-full"></span>
        </button>
      </div>
    </div>
  </div>

  <!-- Content -->
  <div class="max-w-5xl mx-auto px-6 py-8">

    <!-- ══════════════════════════════════ -->
    <!-- TAB 1: PROFILE                    -->
    <!-- ══════════════════════════════════ -->
    <div *ngIf="activeTab === 'profile'" class="space-y-4">
      <div class="bg-[#161b22] rounded-2xl border border-white/10 p-6">
        <h2 class="text-lg font-semibold mb-6 flex items-center gap-2">
          <mat-icon class="text-cyan-500 !text-xl">person</mat-icon>
          Personal Information
        </h2>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
          <!-- Name -->
          <div>
            <label class="block text-xs font-medium text-gray-400 mb-2 uppercase tracking-wider">Full Name</label>
            <div class="flex items-center gap-3 bg-[#0d1117] border border-white/10 rounded-xl px-4 py-3">
              <mat-icon class="text-gray-500 !text-lg">person_outline</mat-icon>
              <span class="text-white">{{ userData?.name || '—' }}</span>
            </div>
          </div>

          <!-- Email -->
          <div>
            <label class="block text-xs font-medium text-gray-400 mb-2 uppercase tracking-wider">Email Address</label>
            <div class="flex items-center gap-3 bg-[#0d1117] border border-white/10 rounded-xl px-4 py-3">
              <mat-icon class="text-gray-500 !text-lg">email</mat-icon>
              <span class="text-white">{{ userData?.email || '—' }}</span>
            </div>
          </div>

          <!-- Phone -->
          <div>
            <label class="block text-xs font-medium text-gray-400 mb-2 uppercase tracking-wider">Phone Number</label>
            <div class="flex items-center gap-3 bg-[#0d1117] border border-white/10 rounded-xl px-4 py-3">
              <mat-icon class="text-gray-500 !text-lg">phone</mat-icon>
              <span class="text-white">{{ userData?.phone || '—' }}</span>
            </div>
          </div>

          <!-- Role -->
          <div>
            <label class="block text-xs font-medium text-gray-400 mb-2 uppercase tracking-wider">Account Type</label>
            <div class="flex items-center gap-3 bg-[#0d1117] border border-white/10 rounded-xl px-4 py-3">
              <mat-icon class="text-cyan-500 !text-lg">verified_user</mat-icon>
            
            </div>
          </div>
        </div>
      </div>

      <!-- Logout Button -->
      <div class="bg-[#161b22] rounded-2xl border border-red-500/20 p-6">
        <h3 class="text-sm font-semibold text-red-400 mb-4 flex items-center gap-2">
          <mat-icon class="!text-lg">warning</mat-icon>
          Danger Zone
        </h3>
        <button
          (click)="logout()"
          class="flex items-center gap-2 px-5 py-2.5 bg-red-500/10 hover:bg-red-500/20 border border-red-500/30 text-red-400 rounded-xl font-medium transition-all text-sm"
        >
          <mat-icon class="!text-lg">logout</mat-icon>
          Logout from account
        </button>
      </div>
    </div>


    <!-- ══════════════════════════════════ -->
    <!-- TAB 2: ADDRESSES                  -->
    <!-- ══════════════════════════════════ -->
    <div *ngIf="activeTab === 'addresses'" class="space-y-6">

      <!-- Success/Error Alerts -->
      <div *ngIf="addressSuccess()" class="flex items-center gap-3 bg-green-500/10 border border-green-500/30 text-green-400 rounded-xl px-4 py-3 text-sm">
        <mat-icon class="!text-lg">check_circle</mat-icon>
        {{ addressSuccess() }}
      </div>
      <div *ngIf="addressError()" class="flex items-center gap-3 bg-red-500/10 border border-red-500/30 text-red-400 rounded-xl px-4 py-3 text-sm">
        <mat-icon class="!text-lg">error</mat-icon>
        {{ addressError() }}
      </div>

      <!-- Add New Address Form -->
      <div class="bg-[#161b22] rounded-2xl border border-white/10 p-6">
        <h2 class="text-lg font-semibold mb-6 flex items-center gap-2">
          <mat-icon class="text-cyan-500 !text-xl">add_location_alt</mat-icon>
          Add New Address
        </h2>

        <form [formGroup]="addressForm" (ngSubmit)="addAddress()" class="space-y-4">
          <!-- Row 1: Name + City -->
          <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
            <!-- Address Name -->
            <div>
              <label class="block text-xs font-medium text-gray-400 mb-2 uppercase tracking-wider">
                Address Name <span class="text-red-400">*</span>
              </label>
              <div class="relative">
                <mat-icon class="absolute left-3 top-1/2 -translate-y-1/2 text-gray-500 !text-lg pointer-events-none">person_pin</mat-icon>
                <input
                  formControlName="name"
                  type="text"
                  placeholder="Home, Work, etc."
                  class="w-full pl-10 pr-4 py-3 bg-[#0d1117] border rounded-xl text-white placeholder-gray-600 focus:outline-none focus:ring-2 focus:ring-cyan-500 transition-all"
                  [class.border-red-500]="isFieldInvalid(addressForm, 'name')"
                  [class.border-white/10]="!isFieldInvalid(addressForm, 'name')"
                />
              </div>
              <p *ngIf="isFieldInvalid(addressForm, 'name')" class="text-red-400 text-xs mt-1">Address name is required</p>
            </div>

            <!-- City -->
            <div>
              <label class="block text-xs font-medium text-gray-400 mb-2 uppercase tracking-wider">
                City <span class="text-red-400">*</span>
              </label>
              <div class="relative">
                <mat-icon class="absolute left-3 top-1/2 -translate-y-1/2 text-gray-500 !text-lg pointer-events-none">location_city</mat-icon>
                <input
                  formControlName="city"
                  type="text"
                  placeholder="Cairo, Alexandria, etc."
                  class="w-full pl-10 pr-4 py-3 bg-[#0d1117] border rounded-xl text-white placeholder-gray-600 focus:outline-none focus:ring-2 focus:ring-cyan-500 transition-all"
                  [class.border-red-500]="isFieldInvalid(addressForm, 'city')"
                  [class.border-white/10]="!isFieldInvalid(addressForm, 'city')"
                />
              </div>
              <p *ngIf="isFieldInvalid(addressForm, 'city')" class="text-red-400 text-xs mt-1">City is required</p>
            </div>
          </div>

          <!-- Phone -->
          <div>
            <label class="block text-xs font-medium text-gray-400 mb-2 uppercase tracking-wider">
              Phone Number <span class="text-red-400">*</span>
            </label>
            <div class="relative">
              <mat-icon class="absolute left-3 top-1/2 -translate-y-1/2 text-gray-500 !text-lg pointer-events-none">phone</mat-icon>
              <input
                formControlName="phone"
                type="tel"
                placeholder="01XXXXXXXXX"
                class="w-full pl-10 pr-4 py-3 bg-[#0d1117] border rounded-xl text-white placeholder-gray-600 focus:outline-none focus:ring-2 focus:ring-cyan-500 transition-all"
                [class.border-red-500]="isFieldInvalid(addressForm, 'phone')"
                [class.border-white/10]="!isFieldInvalid(addressForm, 'phone')"
              />
            </div>
            <p *ngIf="isFieldInvalid(addressForm, 'phone')" class="text-red-400 text-xs mt-1">Valid Egyptian phone number required (01XXXXXXXXX)</p>
          </div>

          <!-- Details -->
          <div>
            <label class="block text-xs font-medium text-gray-400 mb-2 uppercase tracking-wider">
              Address Details <span class="text-red-400">*</span>
            </label>
            <div class="relative">
              <mat-icon class="absolute left-3 top-3.5 text-gray-500 !text-lg pointer-events-none">location_on</mat-icon>
              <textarea
                formControlName="details"
                rows="3"
                placeholder="Street name, building number, floor, apartment..."
                class="w-full pl-10 pr-4 py-3 bg-[#0d1117] border rounded-xl text-white placeholder-gray-600 focus:outline-none focus:ring-2 focus:ring-cyan-500 transition-all resize-none"
                [class.border-red-500]="isFieldInvalid(addressForm, 'details')"
                [class.border-white/10]="!isFieldInvalid(addressForm, 'details')"
              ></textarea>
            </div>
            <p *ngIf="isFieldInvalid(addressForm, 'details')" class="text-red-400 text-xs mt-1">Address details are required</p>
          </div>

          <!-- Submit Button -->
          <button
            type="submit"
            [disabled]="isAddingAddress()"
            class="w-full py-3.5 bg-gradient-to-r from-cyan-600 to-cyan-500 hover:from-cyan-500 hover:to-cyan-400 text-white font-semibold rounded-xl transition-all disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2"
          >
            <div *ngIf="isAddingAddress()" class="w-4 h-4 border-2 border-white/30 border-t-white rounded-full animate-spin"></div>
            <mat-icon *ngIf="!isAddingAddress()" class="!text-lg">add_location</mat-icon>
            {{ isAddingAddress() ? 'Adding...' : '+ Add Address' }}
          </button>
        </form>
      </div>

      <!-- Saved Addresses -->
      <div class="bg-[#161b22] rounded-2xl border border-white/10 p-6">
        <h2 class="text-lg font-semibold mb-6 flex items-center gap-2">
          <mat-icon class="text-cyan-500 !text-xl">bookmarks</mat-icon>
          Saved Addresses
          <span class="ml-1 px-2 py-0.5 bg-cyan-500/20 text-cyan-400 text-xs rounded-full font-bold">
            {{ addresses().length }}
          </span>
        </h2>

        <!-- Loading -->
        <div *ngIf="isLoadingAddresses()" class="flex justify-center py-10">
          <div class="w-8 h-8 border-2 border-cyan-500/30 border-t-cyan-500 rounded-full animate-spin"></div>
        </div>

        <!-- Empty State -->
        <div *ngIf="!isLoadingAddresses() && addresses().length === 0" class="flex flex-col items-center justify-center py-12 text-center">
          <div class="w-16 h-16 bg-white/5 rounded-2xl flex items-center justify-center mb-4">
            <mat-icon class="!text-4xl text-gray-600">location_off</mat-icon>
          </div>
          <p class="text-gray-400 font-medium">No saved addresses yet</p>
          <p class="text-gray-600 text-sm mt-1">Add your first address above</p>
        </div>

        <!-- Address Cards -->
        <div *ngIf="!isLoadingAddresses() && addresses().length > 0" class="space-y-3">
          <div
            *ngFor="let address of addresses()"
            class="flex items-start justify-between bg-[#0d1117] border border-white/10 rounded-xl p-4 hover:border-cyan-500/30 transition-all group"
          >
            <div class="flex gap-3">
              <div class="w-10 h-10 bg-cyan-500/10 rounded-xl flex items-center justify-center shrink-0 mt-0.5">
                <mat-icon class="!text-lg text-cyan-500">location_on</mat-icon>
              </div>
              <div>
                <p class="font-semibold text-white">{{ address.name }}</p>
                <p class="text-sm text-gray-400 mt-0.5">{{ address.details }}</p>
                <div class="flex items-center gap-4 mt-2">
                  <span class="flex items-center gap-1 text-xs text-gray-500">
                    <mat-icon class="!text-sm">location_city</mat-icon>
                    {{ address.city }}
                  </span>
                  <span class="flex items-center gap-1 text-xs text-gray-500">
                    <mat-icon class="!text-sm">phone</mat-icon>
                    {{ address.phone }}
                  </span>
                </div>
              </div>
            </div>

            <!-- Delete Button -->
            <button
              (click)="removeAddress(address._id!)"
              class="p-2 text-gray-600 hover:text-red-400 hover:bg-red-500/10 rounded-lg transition-all opacity-0 group-hover:opacity-100"
            >
              <mat-icon class="!text-lg">delete_outline</mat-icon>
            </button>
          </div>
        </div>
      </div>
    </div>


    <!-- ══════════════════════════════════ -->
    <!-- TAB 3: SECURITY                   -->
    <!-- ══════════════════════════════════ -->
    <div *ngIf="activeTab === 'security'" class="space-y-4">

      <!-- Change Password -->
      <div class="bg-[#161b22] rounded-2xl border border-white/10 p-6">
        <h2 class="text-lg font-semibold mb-6 flex items-center gap-2">
          <mat-icon class="text-cyan-500 !text-xl">lock_reset</mat-icon>
          Change Password
        </h2>

        <!-- Alerts -->
        <div *ngIf="passwordSuccess" class="flex items-center gap-3 bg-green-500/10 border border-green-500/30 text-green-400 rounded-xl px-4 py-3 text-sm mb-4">
          <mat-icon class="!text-lg">check_circle</mat-icon>
          {{ passwordSuccess }}
        </div>
        <div *ngIf="passwordError" class="flex items-center gap-3 bg-red-500/10 border border-red-500/30 text-red-400 rounded-xl px-4 py-3 text-sm mb-4">
          <mat-icon class="!text-lg">error</mat-icon>
          {{ passwordError }}
        </div>

        <form [formGroup]="passwordForm" (ngSubmit)="changePassword()" class="space-y-4">
          <!-- Current Password -->
          <div>
            <label class="block text-xs font-medium text-gray-400 mb-2 uppercase tracking-wider">
              Current Password <span class="text-red-400">*</span>
            </label>
            <div class="relative">
              <mat-icon class="absolute left-3 top-1/2 -translate-y-1/2 text-gray-500 !text-lg pointer-events-none">lock</mat-icon>
              <input
                formControlName="currentPassword"
                type="password"
                placeholder="Enter current password"
                class="w-full pl-10 pr-4 py-3 bg-[#0d1117] border rounded-xl text-white placeholder-gray-600 focus:outline-none focus:ring-2 focus:ring-cyan-500 transition-all"
                [class.border-red-500]="isFieldInvalid(passwordForm, 'currentPassword')"
                [class.border-white/10]="!isFieldInvalid(passwordForm, 'currentPassword')"
              />
            </div>
          </div>

          <!-- New Password -->
          <div>
            <label class="block text-xs font-medium text-gray-400 mb-2 uppercase tracking-wider">
              New Password <span class="text-red-400">*</span>
            </label>
            <div class="relative">
              <mat-icon class="absolute left-3 top-1/2 -translate-y-1/2 text-gray-500 !text-lg pointer-events-none">lock_open</mat-icon>
              <input
                formControlName="password"
                type="password"
                placeholder="Enter new password (min 6 chars)"
                class="w-full pl-10 pr-4 py-3 bg-[#0d1117] border rounded-xl text-white placeholder-gray-600 focus:outline-none focus:ring-2 focus:ring-cyan-500 transition-all"
                [class.border-red-500]="isFieldInvalid(passwordForm, 'password')"
                [class.border-white/10]="!isFieldInvalid(passwordForm, 'password')"
              />
            </div>
          </div>

          <!-- Confirm Password -->
          <div>
            <label class="block text-xs font-medium text-gray-400 mb-2 uppercase tracking-wider">
              Confirm New Password <span class="text-red-400">*</span>
            </label>
            <div class="relative">
              <mat-icon class="absolute left-3 top-1/2 -translate-y-1/2 text-gray-500 !text-lg pointer-events-none">lock_open</mat-icon>
              <input
                formControlName="rePassword"
                type="password"
                placeholder="Confirm new password"
                class="w-full pl-10 pr-4 py-3 bg-[#0d1117] border rounded-xl text-white placeholder-gray-600 focus:outline-none focus:ring-2 focus:ring-cyan-500 transition-all"
                [class.border-red-500]="isFieldInvalid(passwordForm, 'rePassword')"
                [class.border-white/10]="!isFieldInvalid(passwordForm, 'rePassword')"
              />
            </div>
          </div>

          <button
            type="submit"
            [disabled]="isChangingPassword"
            class="w-full py-3.5 bg-gradient-to-r from-cyan-600 to-cyan-500 hover:from-cyan-500 hover:to-cyan-400 text-white font-semibold rounded-xl transition-all disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2"
          >
            <div *ngIf="isChangingPassword" class="w-4 h-4 border-2 border-white/30 border-t-white rounded-full animate-spin"></div>
            <mat-icon *ngIf="!isChangingPassword" class="!text-lg">save</mat-icon>
            {{ isChangingPassword ? 'Saving...' : 'Save New Password' }}
          </button>
        </form>
      </div>
    </div>

  </div>
</div>